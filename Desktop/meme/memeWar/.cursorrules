# üéØ iOS –ú–µ–º –ö–∞—Ä—Ç–æ—á–Ω–∞—è –ò–≥—Ä–∞ - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø)

## üì± –û–°–ù–û–í–ù–´–ï –¢–ï–•–ù–û–õ–û–ì–ò–ò
- **SwiftUI** - –æ—Å–Ω–æ–≤–Ω–æ–π UI framework
- **Combine** - —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ  
- **URLSession** - HTTP –∑–∞–ø—Ä–æ—Å—ã
- **WebSocket** - —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –∫–æ–º–Ω–∞—Ç
- **Keychain** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- **Nuke/Kingfisher** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **TestFlight** - –¥–ª—è –±–µ—Ç–∞-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

### MVVM-S: Model-View-ViewModel-State
- **Models** - –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (Codable)
- **Views** - SwiftUI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. View ‚Äî —ç—Ç–æ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (State)
- **ViewModels** - –£–ø—Ä–∞–≤–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π –∏ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **State** - –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è View. `@Published var gameState: GameState` ‚Äî –∫–ª—é—á–µ–≤–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å WebSocket –≤ UI
1. WebSocketManager –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
2. –ü–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π ViewModel (–Ω–∞–ø—Ä–∏–º–µ—Ä, GameViewModel)
3. ViewModel –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤–æ—é –º–æ–¥–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è (State)
4. View, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è
5. **–ó–ê–ü–†–ï–©–ï–ù–û**: View –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å WebSocketManager

### Dependency Injection
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (AuthRepositoryProtocol, etc.)
- –í–Ω–µ–¥—Ä—è–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
- –°–æ–∑–¥–∞–≤–∞–π –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–π `@Published` –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Combine –∏–ª–∏ `async/await` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ObservableObject –¥–ª—è ViewModels

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
MemeCardGame/
‚îú‚îÄ‚îÄ App/
‚îÇ   ‚îú‚îÄ‚îÄ MemeCardGameApp.swift
‚îÇ   ‚îî‚îÄ‚îÄ AppStateObserver.swift
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Network/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NetworkManager.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ APIService.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WebSocketManager.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NetworkError.swift
‚îÇ   ‚îú‚îÄ‚îÄ Storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenManager.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ KeychainManager.swift
‚îÇ   ‚îú‚îÄ‚îÄ Cache/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ImageCacheManager.swift
‚îÇ   ‚îú‚îÄ‚îÄ Utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Constants.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Extensions/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Helpers/
‚îÇ   ‚îî‚îÄ‚îÄ DI/
‚îÇ       ‚îî‚îÄ‚îÄ DependencyContainer.swift
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthModels.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserModels.swift
‚îÇ   ‚îú‚îÄ‚îÄ Cards/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CardModels.swift
‚îÇ   ‚îú‚îÄ‚îÄ Game/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomModels.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameState.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketEvents.swift
‚îÇ   ‚îî‚îÄ‚îÄ Common/
‚îÇ       ‚îî‚îÄ‚îÄ BaseModels.swift
‚îú‚îÄ‚îÄ Repositories/
‚îÇ   ‚îú‚îÄ‚îÄ AuthRepository.swift
‚îÇ   ‚îú‚îÄ‚îÄ CardsRepository.swift
‚îÇ   ‚îú‚îÄ‚îÄ UserRepository.swift
‚îÇ   ‚îú‚îÄ‚îÄ GameRepository.swift
‚îÇ   ‚îî‚îÄ‚îÄ RoomRepository.swift
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.swift
‚îÇ   ‚îú‚îÄ‚îÄ CardsService.swift
‚îÇ   ‚îú‚îÄ‚îÄ GameService.swift
‚îÇ   ‚îî‚îÄ‚îÄ WebSocketService.swift
‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginViewModel.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileViewModel.swift
‚îÇ   ‚îú‚îÄ‚îÄ Game/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameViewModel.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoomViewModel.swift
‚îÇ   ‚îî‚îÄ‚îÄ Common/
‚îÇ       ‚îî‚îÄ‚îÄ BaseViewModel.swift
‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginView.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileSetupView.swift
‚îÇ   ‚îú‚îÄ‚îÄ Game/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VotingView.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GameResultView.swift
‚îÇ   ‚îú‚îÄ‚îÄ Common/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoadingView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ErrorView.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AsyncImageView.swift
‚îÇ   ‚îî‚îÄ‚îÄ Main/
‚îÇ       ‚îú‚îÄ‚îÄ MainTabView.swift
‚îÇ       ‚îî‚îÄ‚îÄ HomeView.swift
‚îî‚îÄ‚îÄ Resources/
    ‚îú‚îÄ‚îÄ Assets.xcassets
    ‚îú‚îÄ‚îÄ Localizable.strings
    ‚îî‚îÄ‚îÄ Info.plist
```

## üîß –ü–†–ê–í–ò–õ–ê –†–ê–ó–†–ê–ë–û–¢–ö–ò

### SwiftUI Best Practices
- –ò—Å–ø–æ–ª—å–∑—É–π `@StateObject` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ViewModel
- `@ObservedObject` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ ViewModel –≤ –¥–æ—á–µ—Ä–Ω–∏–µ View
- `@EnvironmentObject` –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, TokenManager)
- `@State` —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ, –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è View (–Ω–∞–ø—Ä–∏–º–µ—Ä, isPresented)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ö—Ä–∞–Ω–∏ —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ UserDefaults. –ò—Å–ø–æ–ª—å–∑—É–π Keychain
- **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π HTTPS (wss:// –¥–ª—è WebSocket) –≤ production
- –†–µ–∞–ª–∏–∑—É–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏ 401 Unauthorized –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–ª–æ–≥–∏–Ω–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ö–≠–®–ò–†–£–ô –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø**. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∫–∞—Ä—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã
- –ò–∑–±–µ–≥–∞–π —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ body View. –í—ã–Ω–æ—Å–∏ –∏—Ö –≤ ViewModel –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π lazy –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## üåê API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –ë–∞–∑–æ–≤—ã–µ URL
```swift
// Constants.swift
struct APIConstants {
    static let baseURL = "http://localhost:8000"  // Development
    static let wsBaseURL = "ws://localhost:8000"  // Development
    
    // Endpoints
    struct Endpoints {
        // Auth
        static let deviceAuth = "/auth/device"
        static let completeProfile = "/auth/complete-profile"
        static let me = "/auth/me"
        static let logout = "/auth/logout"
        
        // Cards
        static let allCards = "/cards"
        static let assignStarterCards = "/cards/assign-starter-cards"
        static let myCards = "/cards/my-cards"
        static let forGameRound = "/cards/for-game-round"
        static let cardsByType = "/cards/by-type"
        static let azureStatus = "/cards/azure/status"
        static let azureLoadByType = "/cards/azure/load"
        static let azureLoadAll = "/cards/azure/load-all"
        static let cardStatistics = "/cards/statistics"
        static let adminCreateBatch = "/cards/admin/create-batch"
        static let awardWinnerCard = "/cards/award-winner-card"
        
        // Users
        static let leaderboard = "/users"
        static let checkNickname = "/users/check-nickname"
        static let myStats = "/users/me/stats"
        static let getUserById = "/users"
        static let updateProfile = "/users/me"
        static let updateRating = "/users/{user_id}/rating"
        static let getUserRank = "/users/{user_id}/rank"
        
        // Rooms
        static let createRoom = "/rooms"
        static let availableRooms = "/rooms/available"
        static let myRoom = "/rooms/my-room"
        static let roomDetails = "/rooms/{room_id}"
        static let joinRoom = "/rooms/{room_id}/join"
        static let joinByCode = "/rooms/join-by-code"
        static let quickMatch = "/rooms/quick-match"
        static let leaveRoom = "/rooms/{room_id}/leave"
        static let startGame = "/rooms/{room_id}/start-game"
        static let roomStats = "/rooms/stats/summary"
        
        // Games
        static let myCardsForGame = "/games/my-cards-for-game"
        static let generateSituations = "/games/situations/generate"
        static let currentGame = "/games/rooms/{room_id}/current-game"
        static let gameDetails = "/games/{game_id}"
        static let createRound = "/games/{game_id}/rounds"
        static let submitChoice = "/games/rounds/{round_id}/choices"
        static let startVoting = "/games/rounds/{round_id}/voting/start"
        static let submitVote = "/games/rounds/{round_id}/votes"
        static let roundResults = "/games/rounds/{round_id}/results"
        static let roundChoices = "/games/rounds/{round_id}/choices"
        static let endGame = "/games/{game_id}/end"
        static let pingRoom = "/games/rooms/{room_id}/ping"
        static let playersStatus = "/games/rooms/{room_id}/players-status"
        static let checkTimeouts = "/games/rooms/{room_id}/check-timeouts"
        static let actionStatus = "/games/rounds/{round_id}/action-status"
        
        // WebSocket
        static let websocket = "/websocket/ws"
        static let wsStats = "/websocket/ws/stats"
        static let wsBroadcast = "/websocket/ws/broadcast/{room_id}"
    }
}
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
```swift
// Models/Auth/AuthModels.swift
struct AuthResponse: Codable {
    let access_token: String
    let token_type: String
    let user: UserResponse
    let is_new_user: Bool  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
}

struct DeviceAuthRequest: Codable {
    let device_id: String
}

// Models/Auth/UserModels.swift
enum Gender: String, Codable, CaseIterable {
    case male = "male"
    case female = "female"
    case other = "other"
}

struct UserResponse: Codable {
    let id: Int
    let device_id: String
    let nickname: String?
    let birth_date: Date?  // ‚úÖ Date, –Ω–µ String!
    let gender: Gender?    // ‚úÖ enum, –Ω–µ String!
    let rating: Double     // ‚úÖ Double, –Ω–µ Int!
    let created_at: Date
    let age: Int?          // ‚úÖ –í—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ
    let is_profile_complete: Bool  // ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ñ–∏–ª—è
}

struct UserProfileCreate: Codable {
    let nickname: String
    let birth_date: Date
    let gender: Gender
}

// Models/Cards/CardModels.swift
enum CardType: String, Codable {
    case starter = "starter"
    case standard = "standard"
    case unique = "unique"
}

struct CardResponse: Codable, Identifiable {
    let id: String
    let name: String
    let image_url: String
    let card_type: CardType
    let is_unique: Bool
    let description: String?
    let created_at: Date
    let is_starter_card: Bool
    let is_standard_card: Bool
    let is_unique_card: Bool
}

// Models/Game/RoomModels.swift
enum RoomStatus: String, Codable {
    case waiting = "waiting"
    case playing = "playing"
    case finished = "finished"
}

struct RoomResponse: Codable, Identifiable {
    let id: Int
    let creator_id: Int
    let max_players: Int
    let status: RoomStatus
    let room_code: String?
    let is_public: Bool
    let age_group: String?
    let created_at: Date
    let current_players: Int
}

struct RoomDetailResponse: Codable {
    let room: RoomResponse
    let participants: [RoomParticipantResponse]
    let creator_nickname: String
    let can_start_game: Bool
}

struct RoomParticipantResponse: Codable, Identifiable {
    let id: Int
    let room_id: Int
    let user_id: Int
    let user_nickname: String
    let joined_at: Date
    let status: String
}

// Models/Game/WebSocketEvents.swift
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê WebSocket –°–û–û–ë–©–ï–ù–ò–ô
struct WebSocketMessage: Codable {
    let action: String
    let data: [String: Any]
    
    enum CodingKeys: String, CodingKey {
        case action
        case data
    }
    
    init(action: String, data: [String: Any] = [:]) {
        self.action = action
        self.data = data
    }
    
    init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        action = try container.decode(String.self, forKey: .action)
        data = try container.decode([String: Any].self, forKey: .data)
    }
    
    func encode(to encoder: Encoder) throws {
        var container = encoder.container(keyedBy: CodingKeys.self)
        try container.encode(action, forKey: .action)
        try container.encode(data, forKey: .data)
    }
}

// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ WebSocket –¥–µ–π—Å—Ç–≤–∏—è
enum WebSocketAction: String, CaseIterable {
    case ping = "ping"
    case joinRoom = "join_room"
    case leaveRoom = "leave_room"
    case startGame = "start_game"
    case startRound = "start_round"
    case submitCardChoice = "submit_card_choice"
    case submitVote = "submit_vote"
    case getGameState = "get_game_state"
    case getRoundCards = "get_round_cards"
    case getChoicesForVoting = "get_choices_for_voting"
}

// WebSocket —Å–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
enum WebSocketEventType: String, Codable {
    case pong = "pong"
    case roomStateChanged = "room_state_changed"
    case gameStarted = "game_started"
    case roundStarted = "round_started"
    case votingStarted = "voting_started"
    case roundEnded = "round_ended"
    case gameEnded = "game_ended"
    case playerJoined = "player_joined"
    case playerLeft = "player_left"
    case timeoutWarning = "timeout_warning"
    case playerTimeout = "player_timeout"
}

struct WebSocketEvent: Codable {
    let type: WebSocketEventType
    let data: [String: Any]
    let timestamp: String
}
```

## üéÆ WEBSOCKET –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –†–ê–ë–û–¢–ê –° WebSocket
```swift
// Services/WebSocketService.swift
class WebSocketService: ObservableObject {
    private var webSocket: URLSessionWebSocketTask?
    private let baseURL: String
    private let tokenManager: TokenManager
    
    @Published var isConnected = false
    @Published var lastError: String?
    
    init(baseURL: String, tokenManager: TokenManager) {
        self.baseURL = baseURL
        self.tokenManager = tokenManager
    }
    
    func connect(roomId: Int? = nil) async throws {
        guard let token = tokenManager.getToken() else {
            throw NetworkError.unauthorized
        }
        
        var urlComponents = URLComponents(string: "\(baseURL)/websocket/ws")!
        urlComponents.queryItems = [
            URLQueryItem(name: "token", value: token)
        ]
        
        if let roomId = roomId {
            urlComponents.queryItems?.append(URLQueryItem(name: "room_id", value: "\(roomId)"))
        }
        
        guard let url = urlComponents.url else {
            throw NetworkError.invalidURL
        }
        
        let request = URLRequest(url: url)
        let session = URLSession(configuration: .default)
        webSocket = session.webSocketTask(with: request)
        
        webSocket?.resume()
        isConnected = true
        
        // –ù–∞—á–∏–Ω–∞–µ–º —Å–ª—É—à–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
        await receiveMessages()
    }
    
    func sendMessage(_ message: WebSocketMessage) async throws {
        guard let webSocket = webSocket else {
            throw NetworkError.notConnected
        }
        
        let data = try JSONEncoder().encode(message)
        let webSocketMessage = URLSessionWebSocketTask.Message.data(data)
        
        try await webSocket.send(webSocketMessage)
    }
    
    private func receiveMessages() async {
        guard let webSocket = webSocket else { return }
        
        do {
            let message = try await webSocket.receive()
            
            switch message {
            case .data(let data):
                let event = try JSONDecoder().decode(WebSocketEvent.self, from: data)
                await handleWebSocketEvent(event)
            case .string(let string):
                if let data = string.data(using: .utf8) {
                    let event = try JSONDecoder().decode(WebSocketEvent.self, from: data)
                    await handleWebSocketEvent(event)
                }
            @unknown default:
                break
            }
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–ª—É—à–∞—Ç—å
            await receiveMessages()
            
        } catch {
            lastError = error.localizedDescription
            isConnected = false
        }
    }
    
    @MainActor
    private func handleWebSocketEvent(_ event: WebSocketEvent) {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º ViewModels
        switch event.type {
        case .roomStateChanged:
            NotificationCenter.default.post(name: .roomStateChanged, object: event.data)
        case .gameStarted:
            NotificationCenter.default.post(name: .gameStarted, object: event.data)
        case .roundStarted:
            NotificationCenter.default.post(name: .roundStarted, object: event.data)
        case .votingStarted:
            NotificationCenter.default.post(name: .votingStarted, object: event.data)
        case .roundEnded:
            NotificationCenter.default.post(name: .roundEnded, object: event.data)
        case .gameEnded:
            NotificationCenter.default.post(name: .gameEnded, object: event.data)
        case .playerJoined:
            NotificationCenter.default.post(name: .playerJoined, object: event.data)
        case .playerLeft:
            NotificationCenter.default.post(name: .playerLeft, object: event.data)
        case .timeoutWarning:
            NotificationCenter.default.post(name: .timeoutWarning, object: event.data)
        case .playerTimeout:
            NotificationCenter.default.post(name: .playerTimeout, object: event.data)
        case .pong:
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º ping/pong –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            break
        }
    }
    
    func disconnect() {
        webSocket?.cancel()
        webSocket = nil
        isConnected = false
    }
}

// –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è NotificationCenter
extension Notification.Name {
    static let roomStateChanged = Notification.Name("roomStateChanged")
    static let gameStarted = Notification.Name("gameStarted")
    static let roundStarted = Notification.Name("roundStarted")
    static let votingStarted = Notification.Name("votingStarted")
    static let roundEnded = Notification.Name("roundEnded")
    static let gameEnded = Notification.Name("gameEnded")
    static let playerJoined = Notification.Name("playerJoined")
    static let playerLeft = Notification.Name("playerLeft")
    static let timeoutWarning = Notification.Name("timeoutWarning")
    static let playerTimeout = Notification.Name("playerTimeout")
}
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Unit-—Ç–µ—Å—Ç—ã (XCTest)
- –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É ViewModel –≤ –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç —Å–µ—Ç–∏ –∏ UI
- –°–æ–∑–¥–∞–≤–∞–π –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –¢–µ—Å—Ç–∏—Ä—É–π API –∏ WebSocket —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –º–æ–∫–∏

### UI-—Ç–µ—Å—Ç—ã (XCUITest)
- –¶–µ–ª—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ UI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ó–∞–ø—É—Å–∫–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–æ–≤–µ—Ä—è–π –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è

### End-to-End –∏ –ë–µ—Ç–∞-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (TestFlight)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ 100 —á–µ–ª.)
- –í–Ω–µ—à–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ 10 000 —á–µ–ª.)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

## üìã –ß–ï–ö–õ–ò–°–¢ –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `async/await`
- [ ] –í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Keychain
- [ ] ViewModels —É–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —á–µ—Ä–µ–∑ `@Published` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- [ ] WebSocket-—Å–æ–±—ã—Ç–∏—è —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (Date, Double, enum)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö ViewModel'–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SwiftLint –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- [ ] –í—Å—Ç—Ä–æ–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## üöÄ –ü–õ–ê–ù –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NetworkManager –∏ TokenManager
3. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Auth, User, Card)
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AuthRepository –∏ LoginViewModel
5. –°–æ–∑–¥–∞—Ç—å LoginView –∏ ProfileSetupView

### –§–∞–∑–∞ 2: –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CardsRepository –∏ RoomRepository
2. –°–æ–∑–¥–∞—Ç—å GameRepository –∏ WebSocketManager
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–≥—Ä–æ–≤—ã–µ ViewModels
4. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–≤—ã–µ Views

### –§–∞–∑–∞ 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD
4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ TestFlight

## üéØ –ü–†–ò–ù–¶–ò–ü–´ –ö–û–î–ò–†–û–í–ê–ù–ò–Ø

1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º –∏ —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–º
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º–∏
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ó–∞—â–∏—â–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–æ—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

## üîÑ –†–ê–ë–û–ß–ò–ô –ü–†–û–¶–ï–°–°

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏—á–∏**: –ù–∞—á–∏–Ω–∞–π —Å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö, –∑–∞—Ç–µ–º Repository, ViewModel, View
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–∏—à–∏ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º
3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞–π –∫–æ–¥, —Å–ª–µ–¥—É—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –∏ API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê

- **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π force unwrapping (`!`) –±–µ–∑ —è–≤–Ω–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–í–°–ï–ì–î–ê** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–ª—è WebSocket —Å–æ–±—ã—Ç–∏–π
- **–ü–û–ú–ù–ò** –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- **–¢–ï–°–¢–ò–†–£–ô** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Å–∏–º—É–ª—è—Ç–æ—Ä–µ
- **–ü–†–û–í–ï–†–Ø–ô** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å –±—ç–∫–µ–Ω–¥–æ–º (Date vs String, Double vs Int)

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò

### 1. AuthResponse
- ‚ùå `profile_completed: Bool` ‚Üí ‚úÖ `is_new_user: Bool`

### 2. UserResponse
- ‚ùå `birth_date: String?` ‚Üí ‚úÖ `birth_date: Date?`
- ‚ùå `gender: String?` ‚Üí ‚úÖ `gender: Gender?`
- ‚ùå `rating: Int` ‚Üí ‚úÖ `rating: Double`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã: `age: Int?`, `is_profile_complete: Bool`

### 3. WebSocket —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚ùå `type: GameEventType` ‚Üí ‚úÖ `action: String`
- ‚ùå `payload: T` ‚Üí ‚úÖ `data: [String: Any]`

### 4. WebSocket —Å–æ–±—ã—Ç–∏—è
- ‚ùå –°–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ enum ‚Üí ‚úÖ Action-based –ø–æ–¥—Ö–æ–¥
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ping/pong
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### 5. –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ –í—Å–µ 47 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–∫–∞–∑–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏

## üéâ –ì–û–¢–û–í–û –ö –†–ê–ó–†–ê–ë–û–¢–ö–ï!

–¢–µ–ø–µ—Ä—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –±—ç–∫–µ–Ω–¥—É –∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è iOS —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üöÄ 