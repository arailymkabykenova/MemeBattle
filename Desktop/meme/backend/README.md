# üéÆ Meme Card Game Backend

Backend API –¥–ª—è iOS –∏–≥—Ä—ã —Å –º–µ–º-–∫–∞—Ä—Ç–æ—á–∫–∞–º–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ FastAPI.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd backend

# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
cp env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
nano .env
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

- `JWT_SECRET_KEY` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- `AZURE_STORAGE_CONNECTION_STRING` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Azure Storage
- `AZURE_OPENAI_KEY` - API –∫–ª—é—á Azure OpenAI

### 3. –ó–∞–ø—É—Å–∫ —Å Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker-compose logs -f app
```

### 4. –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- PostgreSQL 15+
- Redis 7+
- Docker & Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env` —Ñ–∞–π–ª–µ. –°–º. `env.example` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | `false` |
| `ENVIRONMENT` | –û–∫—Ä—É–∂–µ–Ω–∏–µ | `development` |
| `JWT_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á JWT | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `DATABASE_URL` | URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |

### Azure –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `AZURE_STORAGE_CONNECTION_STRING` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Azure Storage |
| `AZURE_CONTAINER_NAME` | –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ |
| `AZURE_OPENAI_ENDPOINT` | Endpoint Azure OpenAI |
| `AZURE_OPENAI_KEY` | API –∫–ª—é—á Azure OpenAI |

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1
```

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `cards` - –∫–∞—Ä—Ç–æ—á–∫–∏
- `user_cards` - –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `rooms` - –∏–≥—Ä–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- `room_participants` - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–Ω–∞—Ç
- `games` - –∏–≥—Ä—ã
- `game_rounds` - —Ä–∞—É–Ω–¥—ã –∏–≥—Ä
- `player_choices` - –≤—ã–±–æ—Ä—ã –∫–∞—Ä—Ç
- `votes` - –≥–æ–ª–æ—Å–∞

## üîå API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/login` - –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Game Center
- `POST /auth/verify` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- `POST /auth/logout` - –≤—ã—Ö–æ–¥

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /users/me` - –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /users/me` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- `GET /users/me/cards` - –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ö–æ–º–Ω–∞—Ç—ã
- `POST /rooms` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
- `GET /rooms` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç
- `POST /rooms/{room_id}/join` - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
- `DELETE /rooms/{room_id}/leave` - –≤—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã

### –ò–≥—Ä—ã
- `POST /rooms/{room_id}/start` - –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã
- `GET /games/{game_id}` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ
- `POST /games/rounds/{round_id}/submit-card` - –≤—ã–±–æ—Ä –∫–∞—Ä—Ç—ã
- `POST /games/rounds/{round_id}/vote` - –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ

### WebSocket
- `WS /websocket/ws` - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

## üåê WebSocket API

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```javascript
const ws = new WebSocket('ws://localhost:8000/websocket/ws?token=YOUR_JWT_TOKEN');
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

#### –ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä
- `join_room` - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
- `leave_room` - –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
- `start_game` - –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
- `submit_card_choice` - –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ä—Ç—É
- `submit_vote` - –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å

#### –°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç
- `room_state_updated` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
- `game_started` - –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å
- `round_started` - —Ä–∞—É–Ω–¥ –Ω–∞—á–∞–ª—Å—è
- `voting_started` - –Ω–∞—á–∞–ª–æ—Å—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
- `round_results` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞
- `game_ended` - –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_auth.py::test_login
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
curl http://localhost:8000/health
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`:
- `game.log` - –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- `auth.log` - —Å–æ–±—ã—Ç–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `api.log` - HTTP –∑–∞–ø—Ä–æ—Å—ã
- `websocket.log` - WebSocket —Å–æ–±—ã—Ç–∏—è

## üöÄ –î–µ–ø–ª–æ–π

### Docker Production
```bash
# –°–±–æ—Ä–∫–∞ production –æ–±—Ä–∞–∑–∞
docker build -t meme-backend:latest .

# –ó–∞–ø—É—Å–∫ —Å production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
docker-compose -f docker-compose.yml --profile production up -d
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è production
- `ENVIRONMENT=production`
- `DEBUG=false`
- `CORS_ORIGINS=https://yourdomain.com`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ PostgreSQL –∏ Redis

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª—ã –≤ Git
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ `JWT_SECRET_KEY`
4. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ `CORS_ORIGINS` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ rate limiting

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
JWT_SECRET_KEY=your_super_secure_production_key
POSTGRES_PASSWORD=your_secure_db_password
CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com
```

## üìù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/         # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ repositories/   # –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ routers/        # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ websocket/      # WebSocket –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ external/       # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ alembic/            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints
1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –≤ `app/schemas/`
2. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –≤ `app/services/`
3. –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ `app/routers/`
4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ `app/main.py`

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs app`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ Redis
4. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ 